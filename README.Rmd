---
title: "R package for actionable feature tweaking"
author: Satoshi Kato (@katokohaku)
output: 
  html_document:
    keep_md: yes
  md_document:
    variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE
)
```

# Overview

an implementation to R-package of 
**Gabriele Tolomei, Fabrizio Silvestri, Andrew Haines, Mounia Lalmas "Interpretable Predictions of Tree-based Ensembles via Actionable Feature Tweaking". *See* [KDD 2017](http://www.kdd.org/kdd2017/papers/view/interpretable-predictions-of-tree-based-ensembles-via-actionable-feature-tw) or [arXiv paper](https://arxiv.org/abs/1706.06691)**

# Installation

You can install the **featureTweakR** package from [GitHub](https://github.com/katokohaku/featureTweakR).

```{r eval=FALSE}
install.packages("devtools") # if you have not installed "devtools" package
devtools::install_github("hoxo-m/pforeach") # if you have not installed "pforeach" package
devtools::install_github("katokohaku/featureTweakR")
```

The source code for **featureTweakR** package is available on GitHub at
- https://github.com/katokohaku/featureTweakR.

# Examples

### Data preparation

```{r data.prep, warning=FALSE}
set.seed(777)
require(tidyverse)
require(featureTweakR)

data(spam, package = "kernlab")
i.test  <- sample(1:NROW(spam),  200)
i.train <- intersect(1:NROW(spam),  i.test)

important.var <- c("charExclamation", "charDollar", "remove", "free", "capitalAve", "capitalLong", "your", "hp")
dataset <- spam %>% select(important.var)
data.train <- dataset[i.train, ]
true.y     <- dataset[i.train, ncol(dataset)]
data.test  <- dataset[i.test,  ]
```
### Build ensemble learner & Extract rules

After data preparation, just call wrapper function `learnModel()` to learn ensemble trees + estimate recommendation rules.

```{r learnModel, cache=FALSE}
es <- learnModel(X.train = data.train, true.y = true.y, ntree = 25)
```

### Suggest recommendation

Based on learnt model, new instances that were predicted *`label.from`* will be suggested **how to tweaked**
```{r predict, cache=FALSE}
ft <- predict(es, newdata = data.test, label.from = "spam", label.to = "nonspam")
```
### Visualize recommendation

To visualize predicted-population based feature importance, set `type = "direction"`.

```{r plotPopulation, cache=FALSE}
plot(ft, type = "direction")
```

To visualize suggestion how to change variables of k-th instance to get the desired prediction, set `k = ...`

```{r plotIndividual, cache=FALSE}
plot(ft, k=4)
```

